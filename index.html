<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Genie Image Montage</title>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
		<meta name="viewport" content="width=device-width, initial-scale=1.0"> 
        <meta name="description" content="Automatic Image Montage with jQuery" />
        <meta name="keywords" content="jquery, images, montage, fullscreen, floating, grid, automatic" />
		<meta name="author" content="Codrops" />
		<link rel="shortcut icon" href="../favicon.ico"> 
        <link rel="stylesheet" type="text/css" href="css/demo.css" />
		<link rel="stylesheet" type="text/css" href="css/style.css" />
		<link href='http://fonts.googleapis.com/css?family=PT+Sans+Narrow&v1' rel='stylesheet' type='text/css' />
		<link href='http://fonts.googleapis.com/css?family=Monoton' rel='stylesheet' type='text/css' />
    </head>
    <body id="whole">
		<div class="container">
			<div class="header">
				<span class="right_ab">
					<a href="http://www.behance.net/AndrewLili" title="Behance Profile of Andrey Yakovlev & Lili Aleeva" target="_blank">Images by Andrey & Lili</a>
					<a href="http://creativecommons.org/licenses/by-nc/3.0/" target="_blank" title="Images licensed under CC BY-NC 3.0">CC BY-NC 3.0</a>
				</span>
			</div>
			<div id="overlay" class="content searchbar">
				<div class="inner">
					<h1>Genie<span>  search images... with words</span></h1>
					<h2></h2>
					<h2>Click "Load More..." (end of page) in order to see how more images can be added.</h2>
					<div class="snippet">
						<pre>
							liquid 	: false,
							fixedHeight : 60

							&lt;div class="am-container" id="am-container" style="width:700px;float:right;"/&gt;
						</pre>
					</div>
					<div id="wrap">
					  	<input id="search" name="search" type="text" placeholder="">
						<button id="search_submit" value="Rechercher" type="submit"></button>
					</div>					
					<div class="clr"></div>
					<div id="panel" class="panel hide"></div>
				</div>
			</div>
			<div class="am-container" id="am-container" style="width:700px;float:right;">
				<a href="#"><img src="images/1.jpg"></img></a>
				<a href="#"><img src="images/2.jpg"></img></a>
				<a href="#"><img src="images/3.jpg"></img></a>
				<a href="#"><img src="images/4.jpg"></img></a>
				<a href="#"><img src="images/5.jpg"></img></a>
				<a href="#"><img src="images/6.jpg"></img></a>
				<a href="#"><img src="images/7.jpg"></img></a>
				<a href="#"><img src="images/8.jpg"></img></a>
				<a href="#"><img src="images/9.jpg"></img></a>
				<a href="#"><img src="images/10.jpg"></img></a>
				<a href="#"><img src="images/11.jpg"></img></a>
				<a href="#"><img src="images/12.jpg"></img></a>
				<a href="#"><img src="images/13.jpg"></img></a>
				<a href="#"><img src="images/14.jpg"></img></a>
				<a href="#"><img src="images/15.jpg"></img></a>
				<a href="#"><img src="images/16.jpg"></img></a>
				<a href="#"><img src="images/17.jpg"></img></a>
				<a href="#"><img src="images/18.jpg"></img></a>
				<a href="#"><img src="images/19.jpg"></img></a>
				<a href="#"><img src="images/20.jpg"></img></a>
				<a href="#"><img src="images/21.jpg"></img></a>
				<a href="#"><img src="images/22.jpg"></img></a>
				<a href="#"><img src="images/23.jpg"></img></a>
				<a href="#"><img src="images/24.jpg"></img></a>
				<a href="#"><img src="images/25.jpg"></img></a>
				<a href="#"><img src="images/26.jpg"></img></a>
				<a href="#"><img src="images/27.jpg"></img></a>
				<a href="#"><img src="images/28.jpg"></img></a>
				<a href="#"><img src="images/29.jpg"></img></a>
				<a href="#"><img src="images/30.jpg"></img></a>
				<a href="#"><img src="images/31.jpg"></img></a>
				<a href="#"><img src="images/32.jpg"></img></a>
				<a href="#"><img src="images/33.jpg"></img></a>
				<a href="#"><img src="images/34.jpg"></img></a>
				<a href="#"><img src="images/35.jpg"></img></a>
				<a href="#"><img src="images/36.jpg"></img></a>
				<a href="#"><img src="images/37.jpg"></img></a>
				<a href="#"><img src="images/38.jpg"></img></a>
				<a href="#"><img src="images/39.jpg"></img></a>
				<a href="#"><img src="images/40.jpg"></img></a>
				<a href="#"><img src="images/41.jpg"></img></a>
				<a href="#"><img src="images/42.jpg"></img></a>
				<a href="#"><img src="images/43.jpg"></img></a>
				<a href="#"><img src="images/44.jpg"></img></a>
				<a href="#"><img src="images/45.jpg"></img></a>
				<a href="#"><img src="images/46.jpg"></img></a>
				<a href="#"><img src="images/47.jpg"></img></a>
				<a href="#"><img src="images/48.jpg"></img></a>
				<a href="#"><img src="images/49.jpg"></img></a>
				<a href="#"><img src="images/50.jpg"></img></a>
				<a href="#"><img src="images/51.jpg"></img></a>
				<a href="#"><img src="images/52.jpg"></img></a>
				<a href="#"><img src="images/53.jpg"></img></a>
				<a href="#"><img src="images/54.jpg"></img></a>
				<a href="#"><img src="images/55.jpg"></img></a>
				<a href="#"><img src="images/56.jpg"></img></a>
				<a href="#"><img src="images/57.jpg"></img></a>
				<a href="#"><img src="images/58.jpg"></img></a>
				<a href="#"><img src="images/59.jpg"></img></a>
				<a href="#"><img src="images/60.jpg"></img></a>
				<a href="#"><img src="images/61.jpg"></img></a>
				<a href="#"><img src="images/62.jpg"></img></a>
				<a href="#"><img src="images/63.jpg"></img></a>
				<a href="#"><img src="images/64.jpg"></img></a>
				<a href="#"><img src="images/65.jpg"></img></a>
				<a href="#"><img src="images/66.jpg"></img></a>
				<a href="#"><img src="images/67.jpg"></img></a>
				<a href="#"><img src="images/68.jpg"></img></a>
				<a href="#"><img src="images/69.jpg"></img></a>
				<a href="#"><img src="images/70.jpg"></img></a>
				<a href="#"><img src="images/71.jpg"></img></a>
				<a href="#"><img src="images/72.jpg"></img></a>
				<a href="#"><img src="images/73.jpg"></img></a>
			</div>
			<div id="loadmore" class="loadmore">load more...</div>
		</div>
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
		<script type="text/javascript" src="js/jquery.montage.min.js"></script>
		<script type="text/javascript">
			var lastimg = 1;

			var intervalLoadImg = setInterval(loadMoreImages, 15000);
			var intervalRemoveImg = setInterval(removetopimgs, 30000);
			var imagesAdded = 73;
			var fileLoaded = '', keywordsLoaded = '', prepositions = '';
			$.ajax({
			  url: "data.txt",
			  dataType: "text",
			  async: false,
			  success: function(data){
			    fileLoaded = data;
			    //alert(fileLoaded);
			  }
			});

			$.ajax({
			  url: "preps.txt",
			  dataType: "text",
			  async: false,
			  success: function(data){
			    prepositions = data;
			    //alert(fileLoaded);
			  }
			});

			// array of prepositions
			var preps = prepositions.split("\n");

			// fileLoaded contains file text
			var lines = fileLoaded.split("\n");
			var map = {};
			
			for(var i = 0 ; i < lines.length ; i++) {
				var words = lines[i].split(" ");
				var myArray = new Array();
				for(var j = 1 ; j < words.length ; j++) {
					myArray.push(words[j]);
				}

				map[$.trim(words[0])] = myArray;
			}

			$.ajax({
			  url: "datakey.txt",
			  dataType: "text",
			  async: false,
			  success: function(data2){
			    keywordsLoaded = data2;
			  }
			});

			$('#search').keypress(function (event) {
	          if(event.which == 13 || event.keyCode == 13) {
	          	var searchval = $('#search').val();
	            console.log("Text entered: " + searchval);
	            var message = '';
	            if(searchval.length > 0) {
	            	var searchvals = searchval.split(" ");
	            	for(var i = 0 ; i < preps.length ; i++) {
	            		for(var j = 0 ; j < searchvals.length ; j++) {
	            			if(preps[i] == searchvals[j]) {
	            				var index = searchvals.indexOf(searchvals[j]);
	            				searchvals.splice(index, 1);
	            			}
	            		}
	            		message = searchvals.toString().replace(',', ' ');
	            	}
	            	searchingdata(message);
	            }
	          }
	        });

			function searchingdata(searchval) {
				$('html, body').scroll(function() { $('html, body').stop(); });
				clearInterval(intervalLoadImg);
				clearInterval(intervalRemoveImg);

				// fade out am-container
				$('#am-container').fadeIn(1500);

				// clearing am-container
				$('#am-container').find('a:lt(' + imagesAdded + ')').remove();
				
				var newimgs = '';
				for(var i = 0 ; i < lines.length ; i++) {
					var words = lines[i].split(" ");
					var key = words[0].substring(0, words[0].length - 1);
					
					var searchvals = searchval.split(" ");
					for(var j = 0 ; j < searchvals.length ; j++) {
						if(key == searchvals[j]) {
							for(var j = 1 ; j < words.length - 1; j++) {
								newimgs	+= '<a href="#"><img src="' + words[j] + '"/></a>';
							}
						}
					}
				}
					
				var $newimages = $( newimgs );
				//alert(newimgs);
				$newimages.imagesLoaded( function(){
					$('#am-container').append( $newimages ).montage( 'add', $newimages );
				});
				// loadMoreImages();
				$('html, body').animate({scrollTop:$('#loadmore').position().top}, 20000);
				//alert('out');
				// restore am-container
				//loadMoreImages();

				// $('#am-container').fadeIn();
				// restart load image interval - 10000
				// intervalLoadImg = setInterval(loadMoreImages, 15000);
				// // alert('w');
				// // // restart remove image interval - 30000
				// intervalRemoveImg = setInterval(removetopimgs, 30000);
			}

			function get(k) {
			    return map[k];
			}

			function loadMoreImages() {
				console.log('adding 150');
				$('#overlay').fadeIn(500);
				//var imgarr	= new Array();
				var count = lastimg, index = 0;
				for( var newimgs = ''; count < 125; count++ ) {
					//imgarr.push( i );
					index = count%125;
					newimgs	+= '<a href="" class="' + index + '"><img src="images/' + index + '.jpg"/></a>';
				}
				lastimg = count%124;
				imagesAdded += 125;
				//alert('w');
				// var len = imgarr.length;
				// for( var i = 0, newimgs = ''; i < 15; ++i ) {
				// 	var pos = Math.floor( Math.random() * len ),
				// 		src	= imgarr[pos];
				// 	newimgs	+= '<a href=""><img src="images/' + src + '.jpg"/></a>';
				// }
				
				var $newimages = $( newimgs );
				$newimages.imagesLoaded( function(){
					$('#am-container').append( $newimages ).montage( 'add', $newimages );
				});
				$('html, body').animate({scrollTop:$('#loadmore').position().top}, 20000);
				
			}

			function removetopimgs() {
				console.log('deleting 200');
				$('#am-container').find('a:lt(200)').remove();
			}
			
			//$('html,body').animate({ scrollTop: element.offset().top }, 'slow');

			// var intervalID2 = setInterval(function() {
				
			//   	$('html, body').animate({scrollTop:$('#loadmore').position().top}, 5000);
			//   // alert('ww');
			// }, 1500);

			$(function() {
				/* 
				 * just for this demo:
				 */
				$('#showcode').toggle(
					function() {
						$(this).addClass('up').removeClass('down').next().slideDown();
					},
					function() {
						$(this).addClass('down').removeClass('up').next().slideUp();
					}
				);
				$('#panel').toggle(
					function() {
						$(this).addClass('show').removeClass('hide');
						$('#overlay').stop().animate( { left : - $('#overlay').width() + 20 + 'px' }, 300 );
					},
					function() {
						$(this).addClass('hide').removeClass('show');
						$('#overlay').stop().animate( { left : '0px' }, 300 );
					}
				);
				
				
				var $container 	= $('#am-container'),
					$imgs		= $container.find('img').hide(),
					totalImgs	= $imgs.length,
					cnt			= 0;
				
				$imgs.each(function(i) {
					var $img	= $(this);
					$('<img/>').load(function() {
						++cnt;
						if( cnt === totalImgs ) {
							$imgs.show();
							$container.montage({
								liquid 	: false,
								fixedHeight : 60
							});
							
							/* 
							 * just for this demo:
							 */
							$('#overlay').fadeIn(500);
							var imgarr	= new Array();
							for( var i = 1; i <= 73; ++i ) {
								imgarr.push( i );
							}
							// loads 50 images
							$('#loadmore').show().bind('click', function() {location.reload(); });
						}
					}).attr('src',$img.attr('src'));
				});	
				
			});

			function pausecomp(millis)
			 {
			  var date = new Date();
			  var curDate = null;
			  do { curDate = new Date(); }
			  while(curDate-date < millis);
			}
		</script>
    </body>
</html>